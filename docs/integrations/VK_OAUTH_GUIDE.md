# üîê VK OAuth –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

## üìã –û–±–∑–æ—Ä

VK OAuth –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º VKontakte. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫—É VK ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## üåü –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **OAuth 2.0 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** —á–µ—Ä–µ–∑ VKontakte
- ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞** –ø–æ —Å–ø–∏—Å–∫—É —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö VK ID
- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å VK Teams –±–æ—Ç–æ–º** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** —á–µ—Ä–µ–∑ ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–ª–∏ YAML —Ñ–∞–π–ª
- ‚úÖ **JWT —Ç–æ–∫–µ–Ω—ã** –¥–ª—è —Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ VK –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [vk.com/apps?act=manage](https://vk.com/apps?act=manage)
2. –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"**
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø **"–í–µ–±-—Å–∞–π—Ç"**
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ:
   - **–ù–∞–∑–≤–∞–Ω–∏–µ**: AI Assistant
   - **–ê–¥—Ä–µ—Å —Å–∞–π—Ç–∞**: `https://your-domain.com`
   - **–ë–∞–∑–æ–≤—ã–π –¥–æ–º–µ–Ω**: `your-domain.com`

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö VK –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **OAuth**:
   - **–î–æ–≤–µ—Ä–µ–Ω–Ω—ã–π redirect URI**: `https://your-domain.com/api/v1/auth/vk/callback`
   - **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: email (–∏ –¥—Ä—É–≥–∏–µ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** (`VK_OAUTH_CLIENT_ID`)
   - **–ó–∞—â–∏—â—ë–Ω–Ω—ã–π –∫–ª—é—á** (`VK_OAUTH_CLIENT_SECRET`)

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

#### –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –í–∫–ª—é—á–µ–Ω–∏–µ VK OAuth
VK_OAUTH_ENABLED=true

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ VK –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
VK_OAUTH_CLIENT_ID="12345678"
VK_OAUTH_CLIENT_SECRET="your_secret_key"
VK_OAUTH_REDIRECT_URI="https://your-domain.com/api/v1/auth/vk/callback"
VK_OAUTH_SCOPE="email"

# –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
ALLOWED_VK_USERS="123456789,987654321,555666777"
```

#### –ß–µ—Ä–µ–∑ YAML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `config/vk_users.yml`:

```yaml
allowed_vk_users:
  - "123456789"  # ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  - "987654321"  # ID –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
  - "555666777"  # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è VK OAuth –ø–æ–ª–µ–π
alembic upgrade head
```

### 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# Docker
docker-compose restart ai-assistant

# –õ–æ–∫–∞–ª—å–Ω–æ
uvicorn app.main:app --reload
```

## üìñ –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

### –ö–∞–∫ —É–∑–Ω–∞—Ç—å VK ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –ø—Ä–æ—Ñ–∏–ª—å VK
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ VK
2. –í –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –Ω–∞–π–¥–∏—Ç–µ ID: `vk.com/id123456789`
3. –ß–∏—Å–ª–æ –ø–æ—Å–ª–µ `id` - —ç—Ç–æ VK ID

#### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VK
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–û–±—â–µ–µ**
2. –í –ø—Ä–∞–≤–æ–º –±–ª–æ–∫–µ –Ω–∞–π–¥–∏—Ç–µ **"–ê–¥—Ä–µ—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã"**
3. –ù–æ–º–µ—Ä –≤ –ø–æ–ª–µ - —ç—Ç–æ –≤–∞—à VK ID

#### –°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ API
```bash
curl "https://api.vk.com/method/users.get?user_ids=screen_name&v=5.131"
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π ID –≤ —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
ALLOWED_VK_USERS="123456789,987654321,555666777,999888777"
```

#### –ß–µ—Ä–µ–∑ YAML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```yaml
allowed_vk_users:
  - "123456789"
  - "987654321" 
  - "555666777"
  - "999888777"  # –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
```

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

#### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
curl http://localhost:8000/api/v1/auth/vk/check-access/123456789
```

–û—Ç–≤–µ—Ç:
```json
{
  "vk_user_id": "123456789",
  "has_access": true,
  "message": "Access granted"
}
```

#### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ OAuth
```bash
curl http://localhost:8000/api/v1/auth/vk/config
```

#### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
1. –û—Ç–∫—Ä–æ–π—Ç–µ: `http://localhost:8000/api/v1/auth/vk/login`
2. –í—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ VK –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
3. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–µ—Ä–Ω–µ—Ç–µ—Å—å —Å —Ç–æ–∫–µ–Ω–æ–º –¥–æ—Å—Ç—É–ø–∞

## ü§ñ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å VK Teams –±–æ—Ç–æ–º

VK Teams –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–π VK OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É
2. –ë–æ—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç VK ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ VK OAuth API
4. –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

### –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç–∫–∞–∑–µ –≤ –¥–æ—Å—Ç—É–ø–µ
```
üö´ –î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç VK –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–≥–æ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞.

–ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:
1. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ VK OAuth
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–∞—à VK ID –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞:
‚Ä¢ –°–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —Å–∏—Å—Ç–µ–º—ã
‚Ä¢ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à VK ID: 123456789

–ò–∑–≤–∏–Ω–∏—Ç–µ –∑–∞ –Ω–µ—É–¥–æ–±—Å—Ç–≤–∞! üôè
```

## üîß API Endpoints

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

- **`GET /api/v1/auth/vk/login`** - –ò–Ω–∏—Ü–∏–∞—Ü–∏—è OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **`GET /api/v1/auth/vk/callback`** - –û–±—Ä–∞–±–æ—Ç–∫–∞ OAuth callback
- **`GET /api/v1/auth/vk/config`** - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞

- **`GET /api/v1/auth/vk/check-access/{vk_user_id}`** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

```python
import httpx

async def check_user_access(vk_user_id: str) -> bool:
    async with httpx.AsyncClient() as client:
        response = await client.get(
            f"http://localhost:8000/api/v1/auth/vk/check-access/{vk_user_id}"
        )
        if response.status_code == 200:
            data = response.json()
            return data.get("has_access", False)
        return False

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
has_access = await check_user_access("123456789")
if has_access:
    print("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
else:
    print("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω")
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã VK OAuth
pytest tests/unit/test_vk_oauth_auth.py -v

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest tests/unit/test_vk_oauth_auth.py::TestVKAuthService::test_is_user_allowed_positive -v
```

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
```python
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–ø–∏—Å–∫–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö
vk_user_id = "123456789"
assert await vk_auth_service.is_user_allowed(vk_user_id) == True
```

#### –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
```python
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –≤ —Å–ø–∏—Å–∫–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö
vk_user_id = "999999999"
assert await vk_auth_service.is_user_allowed(vk_user_id) == False
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–•—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ**:
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ Git
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–∞–º–∏

2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ redirect URI**:
   - –£–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ç–æ—á–Ω—ã–µ URI –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö VK
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ production

3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**:
   - –£–¥–∞–ª—è–π—Ç–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –í–µ–¥–∏—Ç–µ –∞—É–¥–∏—Ç –¥–æ—Å—Ç—É–ø–∞

4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
   - –õ–æ–≥–∏—Ä—É–π—Ç–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫

- ‚úÖ **CSRF –∑–∞—â–∏—Ç–∞** —á–µ—Ä–µ–∑ state –ø–∞—Ä–∞–º–µ—Ç—Ä
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è redirect URI**
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–æ–≤**
- ‚úÖ **Rate limiting** –Ω–∞ endpoints
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```bash
# –ü–æ–∏—Å–∫ –ª–æ–≥–æ–≤ VK OAuth
grep "VK OAuth" logs/app.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
grep "VK user.*denied access" logs/app.log

# –£—Å–ø–µ—à–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
grep "VK OAuth successful" logs/app.log
```

### –ú–µ—Ç—Ä–∏–∫–∏

- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–π** - —É—Å–ø–µ—à–Ω—ã—Ö –∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö
- **–û—Ç–∫–∞–∑—ã –≤ –¥–æ—Å—Ç—É–ø–µ** - –ø–æ VK ID –∏ –≤—Ä–µ–º–µ–Ω–∏
- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞** VK API
- **–û—à–∏–±–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**

## ‚ùó Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. "VK OAuth is not enabled"
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `VK_OAUTH_ENABLED=true`

#### 2. "Invalid redirect URI"
**–†–µ—à–µ–Ω–∏–µ**: 
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VK –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ URI —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ production

#### 3. "User authorization failed"
**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ VK
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è

#### 4. "Access denied" –¥–ª—è –±–æ—Ç–∞
**–†–µ—à–µ–Ω–∏–µ**:
- –î–æ–±–∞–≤—å—Ç–µ VK ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `ALLOWED_VK_USERS`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å ID
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –û—Ç–ª–∞–¥–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
from app.config import get_settings
settings = get_settings()

print(f"VK OAuth enabled: {settings.VK_OAUTH_ENABLED}")
print(f"Client ID: {settings.VK_OAUTH_CLIENT_ID}")
print(f"Redirect URI: {settings.VK_OAUTH_REDIRECT_URI}")
print(f"Allowed users: {settings.ALLOWED_VK_USERS}")
```

## üìù Changelog

### v1.0.0 (2025-01-04)
- ‚úÖ –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è VK OAuth
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å VK Teams –±–æ—Ç–æ–º
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ ENV –∏ YAML
- ‚úÖ –¢–µ—Å—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è VK API](https://dev.vk.com/reference)
- [OAuth 2.0 VK](https://dev.vk.com/api/access-token/authcode-flow-user)
- [VK Teams Bot API](https://teams.vk.com/botapi/)
- [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ VK –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏](https://vk.com/apps?act=manage)

---

**üí° –°–æ–≤–µ—Ç**: –î–ª—è production –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏. 